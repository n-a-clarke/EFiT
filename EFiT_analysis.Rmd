---
title: "EFiT Data Analysis"
author: "N. A. Clarke"
date: "19 December 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r load packages}
library(broom)
library(effectsize)
library(rstanarm)
library(bayestestR)
library(see)
library(insight)
library(psych)
library(skimr)
library(cowplot)
library(ggdag)
library(readxl)
library(tidyverse)
```

```{r load in data file and tidy, warning=FALSE}
efit <- read_xlsx("EFiT_Main data set_16DEC2019.xlsx") %>% 
  filter(!partNum == 3, !partNum ==30, !partNum == 79) #remove participants no.3 failed screen, no.30 had to withdraw, no.79 may have unreliable results 
#select varibles that aren't automatically processed with other scripts
efit <- efit %>% select(partNum:dualTask_wordsDiff, matrixReason, keepTrack)
efit <- efit %>% rename(participant = partNum)
#load files for automatically processed scripts: dual, nls, rif, rule, stroop
stroopJoin <- read_csv("processedStroop.csv")
ruleJoin <- read_csv("processedRule.csv") 
nlsJoin <- read_csv("processedNLS.csv")
dualJoin <- read_csv("processedDual.csv")
rifJoin <- read_csv("processedRIF.csv")
#join to main set by participant number
efit <- left_join(efit, ruleJoin, by = "participant")#join rule file
efit <- left_join(efit, stroopJoin, by = "participant")#join stroop file
efit <- left_join(efit, nlsJoin, by = "participant")#join nls file
efit <- left_join(efit, dualJoin, by = "participant")#join dual file
efit <- left_join(efit, rifJoin, by = "participant")#join rif file
```
#Data overview and descriptive statistics
```{r add categories and count}
efit <- efit %>% 
  mutate(
    THI_cat = ifelse(
      THI >= 38 ,"modsev", ifelse(
        THI > 0 & THI <= 37, "mild", "none"
      ))) #add a categorical variable with the groups split by THI scores

efit$THI_cat <- as.factor(efit$THI_cat) %>% ordered(levels = c("none", "mild", "modsev"))#factorise tinnitus groups

#divide CRIq score by age
efit <- efit %>% mutate(CRIq_aged = CRIq/age)

#create new RIF variable (proportion of correct respones and RIFdif (i.e. a measure of the RIF effect)
efit <- efit %>% 
mutate(pRIF_RpPlus = (Rp_plus/12) * 100, 
       pRIF_RpMinus = (Rp_minus/12) * 100,
       pRIF_Np = (Np/24) * 100,
       RIF_Diff = pRIF_Np - pRIF_RpMinus)

#group_by tinnitus groups and count
groupCount <- efit %>% 
  group_by(THI_cat) %>% 
  summarise(group_count = n()) %>% 
  arrange(THI_cat)


#group_by tinnitus groups and median age
groupAge <- efit %>% 
  group_by(THI_cat) %>% 
  summarise(median_age = median(age))

RIF <- efit %>% 
  group_by(THI_cat) %>% 
  summarise(Diff = mean(RIF_Diff),
            Plus = mean(pRIF_RpPlus),
            Minus = mean(pRIF_RpMinus),
            Np = mean(pRIF_Np))

```
##Group counts
`r knitr::kable(groupCount)`

##Group ages
`r knitr::kable(groupAge)`

#T-tests
```{r filtered data frames of different groups}
#filter by groups for statistical tests
controls <- efit %>% 
  filter(THI_cat == "none")
mild_tin <- efit %>% 
  filter(THI_cat == "mild")
modsev_tin <- efit %>% 
  filter(THI_cat == "modsev")
```
##Controls and Mild
###Number-letter sequencing
```{r t-test control-mild letter-number sequencing}
nls_control_mild_t.test <- t.test(controls$nls_correct, mild_tin$nls_correct, alternative = "greater",var.equal = F)#controls greater than mild

```

```{r tidy control-mild letter-number sequencing t-test to extract coefficients}
nls_control_mild_t.test_tidy <- tidy(nls_control_mild_t.test)

nls_control_mild_t.test_tidy <- nls_control_mild_t.test_tidy %>% 
  mutate(task = "number_letter_sequencing", groups = "control_mild")
```

###Keep-track
```{r t-test control-mild keep-track}
keeptrack_control_mild_t.test <- t.test(controls$keepTrack, mild_tin$keepTrack, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy control-mild keep-track t-test to extract coefficients}
keeptrack_control_mild_t.test_tidy <- tidy(keeptrack_control_mild_t.test)

keeptrack_control_mild_t.test_tidy <- keeptrack_control_mild_t.test_tidy %>% 
  mutate(task = "keeptrack", groups = "control_mild")
```

###Stroop
####Response time (incongruent)
```{r t-test control-mild stroop}
stroopRT_control_mild_t.test <- t.test(controls$stroop_incongruent, mild_tin$stroop_incongruent, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy control-mild stroop t-test to extract coefficients}
stroopRT_control_mild_t.test_tidy <- tidy(stroopRT_control_mild_t.test)

stroopRT_control_mild_t.test_tidy <- stroopRT_control_mild_t.test_tidy %>% 
  mutate(task = "stroop_rt", groups = "control_mild")
```

####Errors
```{r t-test control-mild stroop errors}
stroopErr_control_mild_t.test <- t.test(controls$stroop_errors, mild_tin$stroop_errors, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy control-mild stroop errors t-test to extract coefficients}
stroopErr_control_mild_t.test_tidy <- tidy(stroopErr_control_mild_t.test) 

stroopErr_control_mild_t.test_tidy <- stroopErr_control_mild_t.test_tidy %>% 
  mutate(task = "stroop_errors", groups = "control_mild")
```

###Retrieval-induced forgetting
```{r t-test control-mild retrieval-induced forgetting}
RIFdiff_control_mild_t.test <- t.test(controls$RIF_Diff, mild_tin$RIF_Diff, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy control-mild retrieval-induced forgetting t-test to extract coefficients}
RIFdiff_control_mild_t.test_tidy <- tidy(RIFdiff_control_mild_t.test) 

RIFdiff_control_mild_t.test_tidy <- RIFdiff_control_mild_t.test_tidy %>% 
  mutate(task = "RIF_diff", groups = "control_mild")
```

###Rule-switching
####Switch cost
```{r control-mild t-test switch cost}
switchcost_control_mild_t.test <- t.test(controls$switch_cost, mild_tin$switch_cost, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy control-mild switch cost t-test to extract coefficients}
switchcost_control_mild_t.test_tidy <- tidy(switchcost_control_mild_t.test) 

switchcost_control_mild_t.test_tidy <- switchcost_control_mild_t.test_tidy %>% 
  mutate(task = "switch_cost", groups = "control_mild")
```

####Errors
```{r control-mild t-test rule-switching errors}
switchErr_control_mild_t.test <- t.test(controls$rule_errors, mild_tin$rule_errors, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy control-mild rule-switching errors t-test to extract coefficients}
switchErr_control_mild_t.test_tidy <- tidy(switchErr_control_mild_t.test) 

switchErr_control_mild_t.test_tidy <- switchErr_control_mild_t.test_tidy %>% 
  mutate(task = "switch_errors", groups = "control_mild")
```

###Dual task
```{r t-test control-mild dual task}
dualtask_control_mild_t.test <- t.test(controls$dual_task_total, mild_tin$dual_task_total, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy control-mild dual task t-test to extract coefficients}
dualtask_control_mild_t.test_tidy <- tidy(dualtask_control_mild_t.test) 

dualtask_control_mild_t.test_tidy <- dualtask_control_mild_t.test_tidy %>% 
  mutate(task = "dual_task", groups = "control_mild")
```

###Matrix reasoning

```{r control-mild t-test matrix reasoning}
matrix_control_mild_t.test <- t.test(controls$matrixReason, mild_tin$matrixReason, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy control-mild matrix reasoning t-test to extract coefficients}
matrix_control_mild_t.test_tidy <- tidy(matrix_control_mild_t.test) 

matrix_control_mild_t.test_tidy <- matrix_control_mild_t.test_tidy %>% 
  mutate(task = "matrix_reasoning", groups = "control_mild")
```

##Controls and Modsev
###Number-letter sequencing
```{r t-test control-modsev letter-number sequencing}
nls_control_modsev_t.test <- t.test(controls$nls_correct, modsev_tin$nls_correct, alternative = "greater",var.equal = F)#controls greater than modsev

```

```{r tidy control-modsev letter-number sequencing t-test to extract coefficients}
nls_control_modsev_t.test_tidy <- tidy(nls_control_modsev_t.test)

nls_control_modsev_t.test_tidy <- nls_control_modsev_t.test_tidy %>% 
  mutate(task = "number_letter_sequencing", groups = "control_modsev")
```

###Keep-track
```{r t-test control-modsev keep-track}
keeptrack_control_modsev_t.test <- t.test(controls$keepTrack, modsev_tin$keepTrack, alternative = "greater",var.equal = F)#controls greater than modsev
```

```{r tidy control-modsev keep-track t-test to extract coefficients}
keeptrack_control_modsev_t.test_tidy <- tidy(keeptrack_control_modsev_t.test)

keeptrack_control_modsev_t.test_tidy <- keeptrack_control_modsev_t.test_tidy %>% 
  mutate(task = "keeptrack", groups = "control_modsev")
```

###Stroop
####Response time (incongruent)
```{r t-test control-modsev stroop}
stroopRT_control_modsev_t.test <- t.test(controls$stroop_incongruent, modsev_tin$stroop_incongruent, alternative = "less",var.equal = F)#controls less than modsev
```

```{r tidy control-modsev stroop t-test to extract coefficients}
stroopRT_control_modsev_t.test_tidy <- tidy(stroopRT_control_modsev_t.test)

stroopRT_control_modsev_t.test_tidy <- stroopRT_control_modsev_t.test_tidy %>% 
  mutate(task = "stroop_rt", groups = "control_modsev")
```

####Errors
```{r t-test control-modsev stroop errors}
stroopErr_control_modsev_t.test <- t.test(controls$stroop_errors, modsev_tin$stroop_errors, alternative = "less",var.equal = F)#controls less than modsev
```

```{r tidy control-modsev stroop errors t-test to extract coefficients}
stroopErr_control_modsev_t.test_tidy <- tidy(stroopErr_control_modsev_t.test) 

stroopErr_control_modsev_t.test_tidy <- stroopErr_control_modsev_t.test_tidy %>% 
  mutate(task = "stroop_errors", groups = "control_modsev")
```

###Retrieval-induced forgetting
```{r t-test control-modsev retrieval-induced forgetting}
RIFdiff_control_modsev_t.test <- t.test(controls$RIF_Diff, modsev_tin$RIF_Diff, alternative = "greater",var.equal = F)#controls greater than modsev
```

```{r tidy control-modsev retrieval-induced forgetting t-test to extract coefficients}
RIFdiff_control_modsev_t.test_tidy <- tidy(RIFdiff_control_modsev_t.test) 

RIFdiff_control_modsev_t.test_tidy <- RIFdiff_control_modsev_t.test_tidy %>% 
  mutate(task = "RIF_diff", groups = "control_modsev")
```

###Rule-switching
####Switch cost
```{r control-modsev t-test switch cost}
switchcost_control_modsev_t.test <- t.test(controls$switch_cost, modsev_tin$switch_cost, alternative = "less",var.equal = F)#controls less than modsev
```

```{r tidy control-modsev switch cost t-test to extract coefficients}
switchcost_control_modsev_t.test_tidy <- tidy(switchcost_control_modsev_t.test) 

switchcost_control_modsev_t.test_tidy <- switchcost_control_modsev_t.test_tidy %>% 
  mutate(task = "switch_cost", groups = "control_modsev")
```

####Errors
```{r control-modsev t-test rule-switching errors}
switchErr_control_modsev_t.test <- t.test(controls$rule_errors, modsev_tin$rule_errors, alternative = "less",var.equal = F)#controls less than modsev
```

```{r tidy control-modsev rule-switching errors t-test to extract coefficients}
switchErr_control_modsev_t.test_tidy <- tidy(switchErr_control_modsev_t.test) 

switchErr_control_modsev_t.test_tidy <- switchErr_control_modsev_t.test_tidy %>% 
  mutate(task = "switch_errors", groups = "control_modsev")
```

###Dual task
```{r t-test control-modsev dual task}
dualtask_control_modsev_t.test <- t.test(controls$dual_task_total, modsev_tin$dual_task_total, alternative = "greater",var.equal = F)#controls greater than modsev
```

```{r tidy control-modsev dual task t-test to extract coefficients}
dualtask_control_modsev_t.test_tidy <- tidy(dualtask_control_modsev_t.test) 

dualtask_control_modsev_t.test_tidy <- dualtask_control_modsev_t.test_tidy %>% 
  mutate(task = "dual_task", groups = "control_modsev")
```

###Matrix reasoning
```{r control-modsev t-test matrix reasoning}
matrix_control_modsev_t.test <- t.test(controls$matrixReason, modsev_tin$matrixReason, alternative = "greater",var.equal = F)#controls greater than modsev
```

```{r tidy control-modsev matrix reasoning t-test to extract coefficients}
matrix_control_modsev_t.test_tidy <- tidy(matrix_control_modsev_t.test) 

matrix_control_modsev_t.test_tidy <- matrix_control_modsev_t.test_tidy %>% 
  mutate(task = "matrix_reasoning", groups = "control_modsev")
```

##Mild and Modsev
###Number-letter sequencing
```{r t-test mild-modsev letter-number sequencing}
nls_mild_modsev_t.test <- t.test(mild_tin$nls_correct, modsev_tin$nls_correct, alternative = "greater",var.equal = F)#mild greater than modsev

```

```{r tidy mild-modsev letter-number sequencing t-test to extract coefficients}
nls_mild_modsev_t.test_tidy <- tidy(nls_mild_modsev_t.test)

nls_mild_modsev_t.test_tidy <- nls_mild_modsev_t.test_tidy %>% 
  mutate(task = "number_letter_sequencing", groups = "mild_modsev")
```

###Keep-track
```{r t-test mild-modsev keep-track}
keeptrack_mild_modsev_t.test <- t.test(mild_tin$keepTrack, modsev_tin$keepTrack, alternative = "greater",var.equal = F)#milds greater than modsev
```

```{r tidy mild-modsev keep-track t-test to extract coefficients}
keeptrack_mild_modsev_t.test_tidy <- tidy(keeptrack_mild_modsev_t.test)

keeptrack_mild_modsev_t.test_tidy <- keeptrack_mild_modsev_t.test_tidy %>% 
  mutate(task = "keeptrack", groups = "mild_modsev")
```

###Stroop
####Response time (incongruent)
```{r t-test mild-modsev stroop}
stroopRT_mild_modsev_t.test <- t.test(mild_tin$stroop_incongruent, modsev_tin$stroop_incongruent, alternative = "less",var.equal = F)#milds less than modsev
```

```{r tidy mild-modsev stroop t-test to extract coefficients}
stroopRT_mild_modsev_t.test_tidy <- tidy(stroopRT_mild_modsev_t.test)

stroopRT_mild_modsev_t.test_tidy <- stroopRT_mild_modsev_t.test_tidy %>% 
  mutate(task = "stroop_rt", groups = "mild_modsev")
```

####Errors
```{r t-test mild-modsev stroop errors}
stroopErr_mild_modsev_t.test <- t.test(mild_tin$stroop_errors, modsev_tin$stroop_errors, alternative = "less",var.equal = F)#milds less than modsev
```

```{r tidy mild-modsev stroop errors t-test to extract coefficients}
stroopErr_mild_modsev_t.test_tidy <- tidy(stroopErr_mild_modsev_t.test) 

stroopErr_mild_modsev_t.test_tidy <- stroopErr_mild_modsev_t.test_tidy %>% 
  mutate(task = "stroop_errors", groups = "mild_modsev")
```

###Retrieval-induced forgetting
```{r t-test mild-modsev retrieval-induced forgetting}
RIFdiff_mild_modsev_t.test <- t.test(mild_tin$RIF_Diff, modsev_tin$RIF_Diff, alternative = "greater",var.equal = F)#milds greater than modsev
```

```{r tidy mild-modsev retrieval-induced forgetting t-test to extract coefficients}
RIFdiff_mild_modsev_t.test_tidy <- tidy(RIFdiff_mild_modsev_t.test) 

RIFdiff_mild_modsev_t.test_tidy <- RIFdiff_mild_modsev_t.test_tidy %>% 
  mutate(task = "RIF_diff", groups = "mild_modsev")
```

###Rule-switching
####Switch cost
```{r mild-modsev t-test switch cost}
switchcost_mild_modsev_t.test <- t.test(mild_tin$switch_cost, modsev_tin$switch_cost, alternative = "less",var.equal = F)#milds less than modsev
```

```{r tidy mild-modsev switch cost t-test to extract coefficients}
switchcost_mild_modsev_t.test_tidy <- tidy(switchcost_mild_modsev_t.test) 

switchcost_mild_modsev_t.test_tidy <- switchcost_mild_modsev_t.test_tidy %>% 
  mutate(task = "switch_cost", groups = "mild_modsev")
```

####Errors
```{r mild-modsev t-test rule-switching errors}
switchErr_mild_modsev_t.test <- t.test(mild_tin$rule_errors, modsev_tin$rule_errors, alternative = "less",var.equal = F)#milds less than modsev
```

```{r tidy mild-modsev rule-switching errors t-test to extract coefficients}
switchErr_mild_modsev_t.test_tidy <- tidy(switchErr_mild_modsev_t.test) 

switchErr_mild_modsev_t.test_tidy <- switchErr_mild_modsev_t.test_tidy %>% 
  mutate(task = "switch_errors", groups = "mild_modsev")
```

###Dual task
```{r t-test mild-modsev dual task}
dualtask_mild_modsev_t.test <- t.test(mild_tin$dual_task_total, modsev_tin$dual_task_total, alternative = "greater",var.equal = F)#milds greater than modsev
```

```{r tidy mild-modsev dual task t-test to extract coefficients}
dualtask_mild_modsev_t.test_tidy <- tidy(dualtask_mild_modsev_t.test) 

dualtask_mild_modsev_t.test_tidy <- dualtask_mild_modsev_t.test_tidy %>% 
  mutate(task = "dual_task", groups = "mild_modsev")
```

###Matrix reasoning
```{r mild-modsev t-test matrix reasoning}
matrix_mild_modsev_t.test <- t.test(mild_tin$matrixReason, modsev_tin$matrixReason, alternative = "greater",var.equal = F)#milds greater than modsev
```

```{r tidy mild-modsev matrix reasoning t-test to extract coefficients}
matrix_mild_modsev_t.test_tidy <- tidy(matrix_mild_modsev_t.test) 

matrix_mild_modsev_t.test_tidy <- matrix_mild_modsev_t.test_tidy %>% 
  mutate(task = "matrix_reasoning", groups = "mild_modsev")
```

##Table of t-test results
###Controls and Mild
```{r bind together tidy t.test results of control and milds}
t.test_table_control_mild <- bind_rows(nls_control_mild_t.test_tidy,
        keeptrack_control_mild_t.test_tidy,
        stroopRT_control_mild_t.test_tidy,
        stroopErr_control_mild_t.test_tidy,
        RIFdiff_control_mild_t.test_tidy,
        switchcost_control_mild_t.test_tidy,
        switchErr_control_mild_t.test_tidy,
        dualtask_control_mild_t.test_tidy,
        matrix_control_mild_t.test_tidy)
```
###Controls and Modsev
```{r bind together tidy t.test results of control and modsev}
t.test_table_control_modsev <- bind_rows(nls_control_modsev_t.test_tidy,
        keeptrack_control_modsev_t.test_tidy,
        stroopRT_control_modsev_t.test_tidy,
        stroopErr_control_modsev_t.test_tidy,
        RIFdiff_control_modsev_t.test_tidy,
        switchcost_control_modsev_t.test_tidy,
        switchErr_control_modsev_t.test_tidy,
        dualtask_control_modsev_t.test_tidy,
        matrix_control_modsev_t.test_tidy)
```    
###Mild and Modsev
```{r bind together tidy t.test results of mild and modsev}
t.test_table_mild_modsev <- bind_rows(nls_mild_modsev_t.test_tidy,
        keeptrack_mild_modsev_t.test_tidy,
        stroopRT_mild_modsev_t.test_tidy,
        stroopErr_mild_modsev_t.test_tidy,
        RIFdiff_mild_modsev_t.test_tidy,
        switchcost_mild_modsev_t.test_tidy,
        switchErr_mild_modsev_t.test_tidy,
        dualtask_mild_modsev_t.test_tidy,
        matrix_mild_modsev_t.test_tidy)
``` 
#Cohen's d
```{r cohens d}

```

#Bayesian t-tests