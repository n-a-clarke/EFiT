---
title: "EFiT Data Analysis"
author: "N. A. Clarke"
date: "19 December 2019"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r load packages}
library(effectsize)
library(rstanarm)
library(bayestestR)
library(see)
library(insight)
library(psych)
library(skimr)
library(cowplot)
library(ggdag)
library(readxl)
library(tidyverse)
```

```{r load in data file and tidy, warning=FALSE}
efit <- read_xlsx("EFiT_Main data set_16DEC2019.xlsx") %>% 
  filter(!partNum == 3, !partNum ==30, !partNum == 79) #remove participants no.3 failed screen, no.30 had to withdraw, no.79 may have unreliable results 
#select varibles that aren't automatically processed with other scripts
efit <- efit %>% select(partNum:dualTask_wordsDiff, matrixReason, keepTrack)
efit <- efit %>% rename(participant = partNum)
#load files for automatically processed scripts: dual, nls, rif, rule, stroop
stroopJoin <- read_csv("processedStroop.csv")
ruleJoin <- read_csv("processedRule.csv") 
nlsJoin <- read_csv("processedNLS.csv")
dualJoin <- read_csv("processedDual.csv")
rifJoin <- read_csv("processedRIF.csv")
#join to main set by participant number
efit <- left_join(efit, ruleJoin, by = "participant")#join rule file
efit <- left_join(efit, stroopJoin, by = "participant")#join stroop file
efit <- left_join(efit, nlsJoin, by = "participant")#join nls file
efit <- left_join(efit, dualJoin, by = "participant")#join dual file
efit <- left_join(efit, rifJoin, by = "participant")#join rif file
```
#Data overview and descriptive statistics
```{r add categories and count}
efit <- efit %>% 
  mutate(
    THI_cat = ifelse(
      THI >= 38 ,"modsev", ifelse(
        THI > 0 & THI <= 37, "mild", "none"
      ))) #add a categorical variable with the groups split by THI scores

efit$THI_cat <- as.factor(efit$THI_cat) %>% ordered(levels = c("none", "mild", "modsev"))#factorise tinnitus groups

#divide CRIq score by age
efit <- efit %>% mutate(CRIq_aged = CRIq/age)

#create new RIF variable (proportion of correct respones and RIFdif (i.e. a measure of the RIF effect)
efit <- efit %>% 
mutate(pRIF_RpPlus = (Rp_plus/12) * 100, 
       pRIF_RpMinus = (Rp_minus/12) * 100,
       pRIF_Np = (Np/24) * 100,
       RIF_Diff = pRIF_Np - pRIF_RpMinus)

#group_by tinnitus groups and count
groupCount <- efit %>% 
  group_by(THI_cat) %>% 
  summarise(group_count = n()) %>% 
  arrange(THI_cat)


#group_by tinnitus groups and median age
groupAge <- efit %>% 
  group_by(THI_cat) %>% 
  summarise(median_age = median(age))

RIF <- efit %>% 
  group_by(THI_cat) %>% 
  summarise(Diff = mean(RIF_Diff),
            Plus = mean(pRIF_RpPlus),
            Minus = mean(pRIF_RpMinus),
            Np = mean(pRIF_Np))

```
##Group counts
`r knitr::kable(groupCount)`

##Group ages
`r knitr::kable(groupAge)`

#T-tests
```{r filtered data frames of different groups}
#filter by groups for statistical tests
controls <- efit %>% 
  filter(THI_cat == "none")
mild_tin <- efit %>% 
  filter(THI_cat == "mild")
modsev_tin <- efit %>% 
  filter(THI_cat == "modsev")
```
##Controls and Mild
###Number-letter sequencing
```{r t-test letter-number sequencing}
t.test(controls$nls_correct, mild_tin$nls_correct, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy letter-number sequencing t-test to extract coefficients}

```
Welch two-sample t-test for number-letter sequencing task shows that...

###Keep-track
```{r t-test keep-track}
t.test(controls$keepTrack, mild_tin$keepTrack, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy keep-track t-test to extract coefficients}

```
Welch two-sample t-test for the keep-track task shows that...

###Stroop
####Response time (incongruent)
```{r t-test stroop}
t.test(controls$stroop_incongruent, mild_tin$stroop_incongruent, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy stroop t-test to extract coefficients}

```
Welch two-sample t-test for the Stroop incongruent response time shows that...

####Errors
```{r t-test stroop errors}
t.test(controls$stroop_errors, mild_tin$stroop_errors, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy stroop errors t-test to extract coefficients}

```
Welch two-sample t-test for the Stroop errors shows that...

###Retrieval-induced forgetting
```{r t-test retrieval-induced forgetting}
t.test(controls$RIF_Diff, mild_tin$RIF_Diff, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy retrieval-induced forgetting t-test to extract coefficients}

```
Welch two-sample t-test for the RIF task shows that...

###Rule-switching
####Switch cost
```{r t-test switch cost}
t.test(controls$switch_cost, mild_tin$switch_cost, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy switch cost t-test to extract coefficients}

```
Welch two-sample t-test for the switch cost shows that...

####Errors
```{r t-test rule-switching errors}
t.test(controls$rule_errors, mild_tin$rule_errors, alternative = "less",var.equal = F)#controls less than mild
```

```{r tidy rule-switching errors t-test to extract coefficients}

```
Welch two-sample t-test for rule-switching errors shows that..


###Dual task
```{r t-test dual task}
t.test(controls$dual_task_total, mild_tin$dual_task_total, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy dual task t-test to extract coefficients}

```
Welch two-sample t-test for the dual task shows that...

###Matrix reasoning

```{r t-test matrix reasoning}
t.test(controls$matrixReason, mild_tin$matrixReason, alternative = "greater",var.equal = F)#controls greater than mild
```

```{r tidy matrix reasoning t-test to extract coefficients}

```
Welch two-sample t-test for the matrix reasoning task shows that...

##Controls and Modsev
##Mild and Modsev
